.. note:: 

    춰Hola! Bienvenido a la Comunidad de Entusiastas de SunFounder para Raspberry Pi, Arduino y ESP32 en Facebook. Explora a fondo Raspberry Pi, Arduino y ESP32 con otros entusiastas.

    **쯇or qu칠 unirse?**

    - **Soporte experto**: Resuelve problemas t칠cnicos y consultas postventa con la ayuda de nuestra comunidad y equipo.
    - **Aprende y comparte**: Intercambia consejos y tutoriales para mejorar tus habilidades.
    - **Vista previa exclusiva**: Obt칠n acceso anticipado a anuncios de nuevos productos y adelantos exclusivos.
    - **Descuentos especiales**: Disfruta de descuentos exclusivos en nuestros productos m치s recientes.
    - **Promociones y sorteos especiales**: Participa en sorteos y promociones de temporada.

    游녤 쯃isto para explorar y crear con nosotros? Haz clic en [|link_sf_facebook|] y 칰nete hoy mismo.

.. _play_sc:

9. Controla con la App de SunFounder
========================================

En este proyecto, aprender치s c칩mo construir un proyecto de control remoto usando la aplicaci칩n SunFounder Controller.
En un entorno LAN, podr치s controlar tu circuito Pico W desde tu tel칠fono o tablet.
Encontrar치s esta aplicaci칩n muy 칰til si deseas construir un robot simple con el Pico W.

Aqu칤, utilizaremos la barra deslizante de la APP para controlar el 치ngulo del servo y el medidor para mostrar la distancia detectada por el sensor ultras칩nico.

**1. Componentes necesarios**

Para este proyecto, necesitamos los siguientes componentes.

Es conveniente comprar un kit completo, aqu칤 tienes el enlace:

.. list-table::
    :widths: 20 20 20
    :header-rows: 1

    *   - Nombre
        - ELEMENTOS EN ESTE KIT
        - ENLACE
    *   - Kit Kepler
        - 450+
        - |link_kepler_kit|

Tambi칠n puedes comprarlos por separado a trav칠s de los enlaces a continuaci칩n.

.. list-table::
    :widths: 5 20 5 20
    :header-rows: 1

    *   - N춿
        - COMPONENTE
        - CANTIDAD
        - ENLACE

    *   - 1
        - :ref:`cpn_pico_w`
        - 1
        - |link_picow_buy|
    *   - 2
        - Cable Micro USB
        - 1
        - 
    *   - 3
        - :ref:`cpn_breadboard`
        - 1
        - |link_breadboard_buy|
    *   - 4
        - :ref:`cpn_wire`
        - Varios
        - |link_wires_buy|
    *   - 5
        - :ref:`cpn_servo`
        - 1
        - |link_servo_buy|
    *   - 6
        - :ref:`cpn_ultrasonic`
        - 1
        - |link_ultrasonic_buy|
    *   - 7
        - :ref:`cpn_lipo_charger`
        - 1
        -  
    *   - 8
        - Bater칤a 18650
        - 1
        -  
    *   - 9
        - Soporte de bater칤a
        - 1
        -  

**2. Arma el circuito**

.. warning:: 
        
    Aseg칰rate de que tu M칩dulo Cargador Li-po est칠 conectado como se muestra en el diagrama. De lo contrario, un cortocircuito podr칤a da침ar tu bater칤a y los componentes.

.. image:: img/wiring/9.sc_bb.png
    :width: 800


**3. Configura el SunFounder Controller**

1. Instala la `SunFounder Controller APP <https://docs.sunfounder.com/projects/sf-controller/en/latest/>`_ desde la **App Store (iOS)** o **Google Play (Android)**.

2. Abre la App y haz clic en el bot칩n **+** en la p치gina de inicio para crear un controlador.

    .. image:: img/sc-a-2.jpg
        :width: 800

3. Aqu칤 elegimos **En Blanco** y **Control Dual Stick**.

    .. image:: img/sc-a-3.jpg
        :width: 800

4. Ahora obtenemos un controlador vac칤o.

    .. image:: img/sc-a-4.jpg
        :width: 800

5. Haz clic en el 치rea **H** y a침ade un widget **Slider** (deslizador).

    .. image:: img/sc-a-5.jpg
        :width: 800

6. Haz clic en el engranaje del control para abrir la ventana de configuraci칩n.

    .. image:: img/sc-a-6.png
        :width: 300

7. Configura el M치ximo en 180 y el M칤nimo en 0, luego haz clic en **Confirmar**.

    .. image:: img/sc-a-7.jpg
        :width: 800

8. Haz clic en el 치rea L y a침ade un widget Medidor (Gauge).

    .. image:: img/sc-a-8.jpg
        :width: 800

9. Haz clic en el engranaje del Medidor, abre la ventana de configuraci칩n, establece el M치ximo en 100, el M칤nimo en 0, y la unidad en cm.

    .. image:: img/sc-a-9.jpg
        :width: 800

10. Despu칠s de terminar la configuraci칩n de los widgets, haz clic en Guardar.

    .. image:: img/sc-a-10.png
        :width: 300

**4. Ejecuta el C칩digo**

.. note:: 
    Si tu Pico W est치 usando actualmente el firmware de Anvil, entonces necesitar치s :ref:`install_micropython_on_pico`.

1. Sube los archivos ``ws.py`` y ``websocket_helper.py`` desde la ruta ``kepler-kit-main/libs`` al Raspberry Pi Pico W.

    .. image:: img/9_sc3.png

2. Haz doble clic en el script ``ws.py`` y completa los campos ``SSID`` y ``PASSWORD`` de tu red Wi-Fi.

    .. image:: img/9_sc1.png

3. Abre el archivo ``9_sunfounder_controller.py`` en la ruta ``kepler-kit-main/iot``. Haz clic en el bot칩n **Ejecutar script actual** o presiona F5 para ejecutarlo. Una vez conectado, ver치s la IP del Pico W.

    .. image:: img/9_sc2.png

    .. note::
        Si deseas que este script se inicie autom치ticamente al encenderse, puedes guardarlo en el Raspberry Pi Pico W como ``main.py``.

4. Regresa a la App SunFounder Controller y haz clic en el bot칩n **Conectar**.

    .. image:: img/sc-c-4.jpg
        :width: 300

5. Si el Pico W es detectado, selecci칩nalo directamente para conectar.

    .. image:: img/sc-c-5.jpg
        :width: 300

6. Si no se encuentra autom치ticamente, tambi칠n puedes ingresar manualmente la IP para conectarlo.

    .. image:: img/sc-c-6.png
        :width: 800

7. Al deslizar la barra en el 치rea H despu칠s de hacer clic en el bot칩n Ejecutar, el servo ajustar치 su 치ngulo. El medidor en el 치rea L mostrar치 la distancia si tu mano est치 a menos de 100 cm del sensor ultras칩nico.

    .. image:: img/sc-c-8.jpg
        :width: 300

**C칩mo funciona**

La clase ``WS_Server`` en la biblioteca ``ws.py`` implementa la comunicaci칩n con la APP. A continuaci칩n se muestra el marco b치sico para implementar su funcionalidad.

.. code-block:: python

    from ws import WS_Server
    import json
    import time

    ws = WS_Server(8765) # inicializar el websocket

    def main():
        ws.start()
        while True:
            status,result=ws.transfer()
            time.sleep_ms(100)

    try:
        main()
    finally:
        ws.stop()

Primero, necesitamos crear un objeto ``WS_Server``.

.. code-block:: python

    ws = WS_Server(8765) 

In칤cialo.

.. code-block:: python

    ws.start()

Luego, se utiliza un bucle ``while True`` para realizar la transferencia de datos entre Pico W y la SunFounder Controller APP.

.. code-block:: python

    while True:
        # transferir datos con websocket
        status, result = ws.transfer()

        # el estado de la transferencia de datos
        print(status)

        # los datos recibidos
        print(result)

        # los datos enviados
        print(ws.send_dict)

        time.sleep_ms(100)

``status`` ser치 ``False`` si no se logran obtener datos de la SunFounder Controller APP.

``result`` son los datos que el Pico W recibi칩 de la APP de SunFounder Controller. 
Al imprimirlos, ver치s algo similar a lo siguiente, que muestra el valor de todas las 치reas de Widgets.

.. code-block:: 

    {'C': None, 'B': None, 'M': None,,,,, 'A': None, 'R': None}

En este caso, imprimimos los valores del 치rea H por separado y los usamos para operar el circuito.

.. code-block:: python

        status,result=ws.transfer()
        #print(result)
        if status == True:
            print(result['H'])


El diccionario ``ws.send_dict`` son los datos que Pico W env칤a a la SunFounder Controller APP. Se crea en la clase ``WS_Server`` y se env칤a al ejecutar ``ws.transfer()``.

Su mensaje aparece como se muestra a continuaci칩n.

.. code-block:: python

    {'Check': 'SunFounder Controller', 'Name': 'PicoW', 'Type': 'Blank'}

Este es un mensaje en blanco; para copiarlo al widget en la SunFounder Controller APP, necesitamos asignar el valor al 치rea correspondiente en el diccionario. Por ejemplo, asignamos el valor ``50`` al 치rea L.

.. code-block:: python

        ws.send_dict['L'] = 50

Los datos se muestran a continuaci칩n:

.. code-block:: python

    {'L': 50, 'Type': 'Blank', 'Name': 'PicoW', 'Check': 'SunFounder Controller'}


Para obtener m치s detalles sobre el uso de SunFounder Controller, consulta `SunFounder Controller APP <https://docs.sunfounder.com/projects/sf-controller/en/latest/>`_.
