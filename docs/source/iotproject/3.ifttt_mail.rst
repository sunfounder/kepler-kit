.. note::

    ã“ã‚“ã«ã¡ã¯ã€SunFounderã®Raspberry Pi & Arduino & ESP32æ„›å¥½å®¶ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã¸ã‚ˆã†ã“ãï¼Facebookä¸Šã§Raspberry Piã€Arduinoã€ESP32ã«ã¤ã„ã¦ã‚‚ã£ã¨æ·±ãæ˜ã‚Šä¸‹ã’ã€ä»–ã®æ„›å¥½å®¶ã¨äº¤æµã—ã¾ã—ã‚‡ã†ã€‚

    **å‚åŠ ã™ã‚‹ç†ç”±ã¯ï¼Ÿ**

    - **ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã‚µãƒãƒ¼ãƒˆ**ï¼šã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚„ãƒãƒ¼ãƒ ã®åŠ©ã‘ã‚’å€Ÿã‚Šã¦ã€è²©å£²å¾Œã®å•é¡Œã‚„æŠ€è¡“çš„ãªèª²é¡Œã‚’è§£æ±ºã—ã¾ã™ã€‚
    - **å­¦ã³ï¼†å…±æœ‰**ï¼šãƒ’ãƒ³ãƒˆã‚„ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’äº¤æ›ã—ã¦ã‚¹ã‚­ãƒ«ã‚’å‘ä¸Šã•ã›ã¾ã—ã‚‡ã†ã€‚
    - **ç‹¬å çš„ãªãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼**ï¼šæ–°è£½å“ã®ç™ºè¡¨ã‚„å…ˆè¡Œãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«æ—©æœŸã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã—ã‚‡ã†ã€‚
    - **ç‰¹åˆ¥å‰²å¼•**ï¼šæœ€æ–°è£½å“ã®ç‹¬å å‰²å¼•ã‚’ãŠæ¥½ã—ã¿ãã ã•ã„ã€‚
    - **ç¥­ã‚Šã®ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‚®ãƒ•ãƒˆ**ï¼šã‚®ãƒ•ãƒˆã‚„ç¥æ—¥ã®ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã«å‚åŠ ã—ã¾ã—ã‚‡ã†ã€‚

    ğŸ‘‰ ç§ãŸã¡ã¨ä¸€ç·’ã«æ¢ç´¢ã—ã€å‰µé€ ã™ã‚‹æº–å‚™ã¯ã§ãã¦ã„ã¾ã™ã‹ï¼Ÿ[|link_sf_facebook|]ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ä»Šã™ãå‚åŠ ã—ã¾ã—ã‚‡ã†ï¼

3. @IFTTTã‚’ä½¿ç”¨ã—ãŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚·ã‚¹ãƒ†ãƒ 
============================================

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ä¾µå…¥è€…ã‚„è¿·ã„è¾¼ã‚“ã å‹•ç‰©ãŒè‡ªå®…ã«ä¾µå…¥ã—ãŸå ´åˆã«æ¤œå‡ºã™ã‚‹PIRã‚»ãƒ³ã‚µãƒ¼ã‚’ä½¿ç”¨ã—ãŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ‡ãƒã‚¤ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚ãã®ã‚ˆã†ãªå ´åˆã«ã¯ã€ãƒ¡ãƒ¼ãƒ«ã§è­¦å‘ŠãŒå±Šãã¾ã™ã€‚

æœ€ã‚‚åŸºæœ¬çš„ãªã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦WebhookãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
Raspberry Pi Pico Wã‹ã‚‰IFTTTã®ã‚µãƒ¼ãƒ“ã‚¹ã«POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€ä¿¡ã•ã‚Œã¾ã™ã€‚
IFTTTã‚’ä½¿ç”¨ã—ã¦ã€Webhookã‚’å‚å—ã—ã€ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã™ã‚‹Appletã‚’ä½œæˆã—ã¾ã™ã€‚

**1. å¿…è¦ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§å¿…è¦ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

ä¾¿åˆ©ãªã®ã¯ã€ã‚­ãƒƒãƒˆå…¨ä½“ã‚’è³¼å…¥ã™ã‚‹ã“ã¨ã§ã™ã€‚ãƒªãƒ³ã‚¯ã¯ã“ã¡ã‚‰ï¼š

.. list-table::
    :widths: 20 20 20
    :header-rows: 1

    *   - åå‰	
        - ã‚­ãƒƒãƒˆå†…å®¹
        - ãƒªãƒ³ã‚¯
    *   - ã‚±ãƒ—ãƒ©ãƒ¼ã‚­ãƒƒãƒˆ	
        - 450+	
        - |link_kepler_kit|

ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‹ã‚‰å€‹ã€…ã«è³¼å…¥ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

.. list-table::
    :widths: 5 20 5 20
    :header-rows: 1

    *   - SN
        - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ	
        - æ•°é‡
        - ãƒªãƒ³ã‚¯
    *   - 1
        - :ref:`cpn_pico_w`
        - 1
        - |link_picow_buy|
    *   - 2
        - ãƒã‚¤ã‚¯ãƒ­USBã‚±ãƒ¼ãƒ–ãƒ«
        - 1
        - 
    *   - 3
        - :ref:`cpn_breadboard`
        - 1
        - |link_breadboard_buy|
    *   - 4
        - :ref:`cpn_wire`
        - æ•°æœ¬
        - |link_wires_buy|
    *   - 5
        - :ref:`cpn_transistor`
        - 1(S8050)
        - |link_transistor_buy|
    *   - 6
        - :ref:`cpn_resistor`
        - 2(1KÎ©, 10KÎ©)
        - |link_resistor_buy|
    *   - 7
        - :ref:`cpn_button`
        - 1
        - |link_button_buy|
    *   - 8
        - ã‚¢ã‚¯ãƒ†ã‚£ãƒ– :ref:`cpn_buzzer`
        - 1
        - 
    *   - 9
        - :ref:`cpn_lipo_charger`
        - 1
        -  
    *   - 10
        - 18650ãƒãƒƒãƒ†ãƒªãƒ¼
        - 1
        -  
    *   - 11
        - ãƒãƒƒãƒ†ãƒªãƒ¼ãƒ›ãƒ«ãƒ€ãƒ¼
        - 1
        -  
    *   - 12
        - :ref:`cpn_pir`
        - 1
        - |link_pir_buy|

**2. å›è·¯ã‚’ä½œæˆã™ã‚‹**

.. warning:: 
        
    Li-po Charger ModuleãŒå›³ã«ç¤ºã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«æ¥ç¶šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚ãã‚Œä»¥å¤–ã®å ´åˆã¯ã€ã‚·ãƒ§ãƒ¼ãƒˆãŒç™ºç”Ÿã—ã€ãƒãƒƒãƒ†ãƒªãƒ¼ã¨å›è·¯ãŒæå‚·ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

.. image:: img/wiring/3.ifttt_mail_bb.png
    :width: 800


**3. IFTTTã®è¨­å®š**

IFTTTã¯ã€ã•ã¾ã–ã¾ãªãƒ‡ãƒ¼ã‚¿ã‚µãƒ¼ãƒ“ã‚¹ã‚’é€£æºã™ã‚‹å¤šæ§˜ãªæ–¹æ³•ã‚’æä¾›ã™ã‚‹ç„¡æ–™ã®ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚

ã“ã“ã§ã¯ã€IFTTTã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã™ã‚‹Webhookï¼ˆã‚«ã‚¹ã‚¿ãƒ URLï¼‰ã«åå¿œã™ã‚‹Appletã‚’ä½œæˆã—ã¾ã™ã€‚
ãã®å¾Œã€IFTTTãŒä»£ã‚ã‚Šã«ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã™ã€‚

ä»¥ä¸‹ã®æ‰‹é †ã§IFTTTã§è¨­å®šã—ã¦ãã ã•ã„ã€‚

1. |link_ifttt| ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã€ãƒ­ã‚°ã‚¤ãƒ³ã¾ãŸã¯ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

    .. image:: img/ifttt-1.png
        :width: 500

2. **Createï¼ˆä½œæˆï¼‰** ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

    .. image:: img/ifttt-2.png
        :width: 500

3. **If Thisï¼ˆã“ã‚ŒãŒèµ·ããŸã‚‰ï¼‰** ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ ã—ã¾ã™ã€‚

    .. image:: img/ifttt-3.png
        :width: 500

4. **Webhooksï¼ˆã‚¦ã‚§ãƒ–ãƒ•ãƒƒã‚¯ï¼‰** ã‚’æ¤œç´¢ã—ã¾ã™ã€‚

    .. image:: img/ifttt-4.png
        :width: 500

5. **Receive a web requestï¼ˆã‚¦ã‚§ãƒ–ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘å–ã‚‹ï¼‰** ã‚’ã‚¿ãƒƒãƒ—ã—ã¾ã™ã€‚

    .. image:: img/ifttt-5.png
        :width: 500

6. ã‚¤ãƒ™ãƒ³ãƒˆåï¼ˆä¾‹ï¼šSecurityWarningï¼‰ã‚’å…¥åŠ›ã—ã€ **Create triggerï¼ˆãƒˆãƒªã‚¬ãƒ¼ã‚’ä½œæˆï¼‰** ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

    .. image:: img/ifttt-6.png
        :width: 500

7. **Then Thatï¼ˆãã‚ŒãŒã‚ã‚Œã°ï¼‰** ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ ã—ã¾ã™ã€‚

    .. image:: img/ifttt-7.png
        :width: 500

8. Emailã‚’æ¤œç´¢ã—ã¾ã™ã€‚

    .. image:: img/ifttt-8.png
        :width: 500

9. **Send me an emailï¼ˆç§ã«ãƒ¡ãƒ¼ãƒ«ã‚’é€ã‚‹ï¼‰** ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

    .. image:: img/ifttt-9.png
        :width: 500

10. **Subjectï¼ˆä»¶åï¼‰** ã¨ **Bodyï¼ˆæœ¬æ–‡ï¼‰** ã‚’å…¥åŠ›ã—ã€ **Create actionï¼ˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½œæˆï¼‰** ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

    .. image:: img/ifttt-10.png
        :width: 500

11. **Continueï¼ˆç¶šã‘ã‚‹ï¼‰** ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€è¨­å®šã‚’å®Œäº†ã—ã¾ã™ã€‚

    .. image:: img/ifttt-11.png
        :width: 500

12. ã‚¿ã‚¤ãƒˆãƒ«åã‚’å¤‰æ›´ã—ã¦ã€å®Œäº†ã§ã™ã€‚

    .. image:: img/ifttt-12.png
        :width: 500

13. è‡ªå‹•çš„ã«Appletè©³ç´°ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã€AppletãŒç¾åœ¨æ¥ç¶šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã€ãŠã‚ˆã³ã‚¹ã‚¤ãƒƒãƒã‚’åˆ‡ã‚Šæ›¿ãˆã¦é–‹å§‹/çµ‚äº†ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚

    .. image:: img/ifttt-13.png
        :width: 500


**4. ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œ**

#. ã™ã§ã«IFTTTã®Appletã‚’ä½œæˆã—ãŸã‚ã‘ã§ã™ãŒã€Pico WãŒIFTTTã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«ã¯APIã‚­ãƒ¼ã‚‚å¿…è¦ã§ã™ã€‚ã“ã‚Œã¯ |link_webhooks| ã‹ã‚‰å–å¾—ã§ãã¾ã™ã€‚

    .. image:: img/ifttt-14.png
        :width: 500

#. ãã‚Œã‚’Raspberry Pi Pico Wå†…ã® ``secrets.py`` ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚

    .. image:: img/3_ifttt4.png

    .. note::

        Pico Wã« ``do_connect.py`` ã¨ ``secrets.py`` ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒãªã„å ´åˆã¯ã€ :ref:`iot_access` ã‚’å‚ç…§ã—ã¦ãã‚Œã‚‰ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

    .. code-block:: python
        :emphasize-lines: 4

        secrets = {
        'ssid': 'SSID',
        'password': 'PASSWORD',
        'webhooks_key': 'WEBHOOKS_API_KEY'
        }

#. ``kepler-kit-main/iot`` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¸‹ã® ``3_ifttt_mail.py`` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãã€ **Fileï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ï¼‰** -> **Save asï¼ˆåå‰ã‚’ä»˜ã‘ã¦ä¿å­˜ï¼‰** ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã‹ã€ ``Ctrl+Shift+S`` ã‚’æŠ¼ã—ã¾ã™ã€‚

    .. image:: img/3_ifttt1.png

#. ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§ **Raspberry Pi Pico** ã‚’é¸æŠã—ã¾ã™ã€‚

    .. image:: img/3_ifttt2.png

#. ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ ``main.py`` ã«è¨­å®šã—ã¾ã™ã€‚åŒã˜ãƒ•ã‚¡ã‚¤ãƒ«ãŒã™ã§ã«Pico Wã«å­˜åœ¨ã™ã‚‹å ´åˆã¯ã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

    .. image:: img/3_ifttt3.png

#. USBã‚±ãƒ¼ãƒ–ãƒ«ã‚’æŠœã„ã¦ã€Li-poãƒãƒ£ãƒ¼ã‚¸ãƒ£ãƒ¼ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§Raspberry Pi Pico Wã«é›»æºã‚’ä¾›çµ¦ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã¨ãã«ãƒ–ã‚¶ãƒ¼ã®éŸ³ãŒèã“ãˆã¾ã™ã€‚PIRãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒé€šã‚Šéãã‚‹äººç‰©/ç”Ÿç‰©ã‚’æ¤œå‡ºã™ã‚‹ã¨ã€ãƒ–ã‚¶ãƒ¼ãŒé³´ã‚Šç¶šã‘ã€è­¦å‘Šã®ãƒ¡ãƒ¼ãƒ«ãŒé€ä¿¡ã•ã‚Œã¾ã™ã€‚ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å†èµ·å‹•ã§ãã¾ã™ã€‚

**ä»•çµ„ã¿ã«ã¤ã„ã¦**

Raspberry Pi Pico Wã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«æ¥ç¶šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã®è©³ç´°ã¯ :ref:`iot_access` ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ãã‚Œã‚’ãã®ã¾ã¾ä½¿ç”¨ã—ã¾ã™ã€‚

.. code-block:: python

    from do_connect import *
    do_connect()

PIRãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å–ã‚Šã€ä½•ã‹ãŒé€šã‚Šéãã‚‹ã¨æ¤œå‡ºã•ã‚ŒãŸå ´åˆã«ã¯ ``motion_detected()`` é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¾ã™ï¼ˆãƒ‡ãƒ¼ã‚¿ã¯0ã‹ã‚‰1ï¼‰ã€‚

.. code-block:: python

    import machine

    sensor = machine.Pin(17, machine.Pin.IN)

    sensor.irq(trigger = machine.Pin.IRQ_RISING, handler = motion_detected)

æ¬¡ã«Pico WãŒIFTTTã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã—ã¾ã™ã€‚IFTTTã«é€ä¿¡ã™ã‚‹ ``message`` ã¯URLã®æ–‡å­—åˆ—ã§ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚
IFTTTã¯ ``secrets['webhooks_key']`` ã§é€ä¿¡è€…ã‚’è­˜åˆ¥ã—ã€ ``event`` ã§ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã‚’è­˜åˆ¥ã—ã¾ã™ã€‚
ã—ãŸãŒã£ã¦ã€ãã‚Œã‚‰ãŒæ­£ç¢ºã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

.. code-block:: python

    import urequests
    from secrets import *

    event = 'SecurityWarning'
    message = f"https://maker.ifttt.com/trigger/{event}/with/key/{secrets['webhooks_key']}"

    def motion_detected(pin):
        urequests.post(message)
        print(message)
        global warn_flag
        warn_flag = True
        sensor.irq(handler = None)

``motion_detected()`` ãŒå‘¼ã³å‡ºã•ã‚Œã‚‹ã¨ã€å¤‰æ•° ``warn_flag`` ãŒ ``True`` ã«è¨­å®šã•ã‚Œã€ãƒ–ã‚¶ãƒ¼ãŒé³´ã‚Šç¶šã‘ã¾ã™ã€‚

.. code-block:: python

    while True:
        if warn_flag == True:
            alarm.toggle()
            time.sleep_ms(50)

ã“ã“ã§ã®ãƒœã‚¿ãƒ³ã®ç›®çš„ã¯ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å†èµ·å‹•ã™ã‚‹ã“ã¨ã§ã™ã€‚

.. code-block:: python

    button = machine.Pin(16, machine.Pin.IN)

    def reset_device(pin):
        machine.reset()

    button.irq(trigger = machine.Pin.IRQ_RISING, handler = reset_device)
