.. note::

    ã“ã‚“ã«ã¡ã¯ã€SunFounderã®Raspberry Pi & Arduino & ESP32æ„›å¥½å®¶ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã¸ã‚ˆã†ã“ãï¼Facebookä¸Šã§Raspberry Piã€Arduinoã€ESP32ã«ã¤ã„ã¦ã‚‚ã£ã¨æ·±ãæ˜ã‚Šä¸‹ã’ã€ä»–ã®æ„›å¥½å®¶ã¨äº¤æµã—ã¾ã—ã‚‡ã†ã€‚

    **å‚åŠ ã™ã‚‹ç†ç”±ã¯ï¼Ÿ**

    - **ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã‚µãƒãƒ¼ãƒˆ**ï¼šã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚„ãƒãƒ¼ãƒ ã®åŠ©ã‘ã‚’å€Ÿã‚Šã¦ã€è²©å£²å¾Œã®å•é¡Œã‚„æŠ€è¡“çš„ãªèª²é¡Œã‚’è§£æ±ºã—ã¾ã™ã€‚
    - **å­¦ã³ï¼†å…±æœ‰**ï¼šãƒ’ãƒ³ãƒˆã‚„ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’äº¤æ›ã—ã¦ã‚¹ã‚­ãƒ«ã‚’å‘ä¸Šã•ã›ã¾ã—ã‚‡ã†ã€‚
    - **ç‹¬å çš„ãªãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼**ï¼šæ–°è£½å“ã®ç™ºè¡¨ã‚„å…ˆè¡Œãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«æ—©æœŸã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã—ã‚‡ã†ã€‚
    - **ç‰¹åˆ¥å‰²å¼•**ï¼šæœ€æ–°è£½å“ã®ç‹¬å å‰²å¼•ã‚’ãŠæ¥½ã—ã¿ãã ã•ã„ã€‚
    - **ç¥­ã‚Šã®ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‚®ãƒ•ãƒˆ**ï¼šã‚®ãƒ•ãƒˆã‚„ç¥æ—¥ã®ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã«å‚åŠ ã—ã¾ã—ã‚‡ã†ã€‚

    ğŸ‘‰ ç§ãŸã¡ã¨ä¸€ç·’ã«æ¢ç´¢ã—ã€å‰µé€ ã™ã‚‹æº–å‚™ã¯ã§ãã¦ã„ã¾ã™ã‹ï¼Ÿ[|link_sf_facebook|]ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ä»Šã™ãå‚åŠ ã—ã¾ã—ã‚‡ã†ï¼

.. _py_passage_counter:

7.4 ä¹—å®¢ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼
==============================

å¤§å‹ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ãƒ¢ãƒ¼ãƒ«ã€ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã‚»ãƒ³ã‚¿ãƒ¼ã€ãƒã‚§ãƒ¼ãƒ³ã‚¹ãƒˆã‚¢ã€ç©ºæ¸¯ã€é§…ã€ç¾è¡“é¤¨ã€å±•ç¤ºä¼šå ´ãªã©ã®å…¬å…±ã®å ´æ‰€ã§ã€ä¹—å®¢ã®æµã‚Œã¯æ¬ ã‹ã›ãªã„ãƒ‡ãƒ¼ã‚¿ã§ã™ã€‚

ä¾‹ãˆã°ã€ç©ºæ¸¯ã‚„é§…ã§ã¯ã€äººã€…ã®æ•°ã‚’å³å¯†ã«åˆ¶å¾¡ã—ã¦ã€å®‰å…¨ã¨å††æ»‘ãªæµã‚Œã‚’ç¢ºä¿ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ã¾ãŸã€ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã‚»ãƒ³ã‚¿ãƒ¼ã‚„ãƒã‚§ãƒ¼ãƒ³ã‚¹ãƒˆã‚¢ã§ã¯ã€ã‚ˆã‚Šå¤šãã®è¨ªå•è€…ãŒã„ã‚‹æ™‚é–“å¸¯ã‚„ã€å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç”Ÿæˆã§ãã‚‹æ³¨æ–‡æ•°ãªã©ã‚’æŠŠæ¡ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚
ãã®çµæœã€äººã€…ã®æ¶ˆè²»ç¿’æ…£ã‚’åˆ†æã—ã€å£²ä¸Šã‚’å‘ä¸Šã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ä¹—å®¢ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã¯ã€ã“ã‚Œã‚‰ã®å…¬å…±ã®å ´æ‰€ã®é‹å–¶ã‚’ç†è§£ã—ã€åŠ¹ç‡çš„ã«é‹å–¶ã‚’æ•´ãˆã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€PIRã‚»ãƒ³ã‚µãƒ¼ã¨4æ¡ã®7ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã‚’ä½¿ç”¨ã—ã¦ã€ã‚·ãƒ³ãƒ—ãƒ«ãªä¹—å®¢ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚


**å¿…è¦ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ä»¥ä¸‹ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå¿…è¦ã§ã™ã€‚

å…¨ä½“ã®ã‚­ãƒƒãƒˆã‚’è³¼å…¥ã™ã‚‹ã®ãŒç¢ºã‹ã«ä¾¿åˆ©ã§ã™ã€ãƒªãƒ³ã‚¯ã¯ã“ã¡ã‚‰ã§ã™ï¼š

.. list-table::
    :widths: 20 20 20
    :header-rows: 1

    *   - åå‰
        - ã‚­ãƒƒãƒˆå†…å®¹
        - ãƒªãƒ³ã‚¯
    *   - ã‚±ãƒ—ãƒ©ãƒ¼ã‚­ãƒƒãƒˆ
        - 450+
        - |link_kepler_kit|

ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‹ã‚‰å€‹åˆ¥ã«è³¼å…¥ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

.. list-table::
    :widths: 5 20 5 20
    :header-rows: 1

    *   - SN
        - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
        - æ•°é‡
        - ãƒªãƒ³ã‚¯

    *   - 1
        - :ref:`cpn_pico_w`
        - 1
        - |link_picow_buy|
    *   - 2
        - Micro USBã‚±ãƒ¼ãƒ–ãƒ«
        - 1
        - 
    *   - 3
        - :ref:`cpn_breadboard`
        - 1
        - |link_breadboard_buy|
    *   - 4
        - :ref:`cpn_wire`
        - æ•°æœ¬
        - |link_wires_buy|
    *   - 5
        - :ref:`cpn_resistor`
        - 4(220Î©)
        - |link_resistor_buy|
    *   - 6
        - :ref:`cpn_4_dit_7_segment`
        - 1
        - 
    *   - 7
        - :ref:`cpn_74hc595`
        - 1
        - |link_74hc595_buy|
    *   - 8
        - :ref:`cpn_pir`
        - 1
        - |link_pir_buy|

**å›è·¯å›³**

|sch_passager_counter| 

* ã“ã®å›è·¯ã¯ã€ :ref:`py_74hc_4dig` ã‚’åŸºã«ã—ã¦ã€PIRãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒè¿½åŠ ã•ã‚Œã¦ã„ã¾ã™ã€‚
* èª°ã‹ãŒé€šéã™ã‚‹ã¨ã€PIRã¯ç´„2.8ç§’é–“ã®é«˜ã„ä¿¡å·ã‚’é€ã‚Šã¾ã™ã€‚
* PIRãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«ã¯äºŒã¤ã®å¯å¤‰æŠµæŠ—ãŒã‚ã‚Šã¾ã™ï¼šä¸€ã¤ã¯æ„Ÿåº¦ã‚’èª¿æ•´ã—ã€ã‚‚ã†ä¸€ã¤ã¯æ¤œå‡ºè·é›¢ã‚’èª¿æ•´ã—ã¾ã™ã€‚PIRãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚ˆã‚ŠåŠ¹æœçš„ã«å‹•ä½œã•ã›ã‚‹ãŸã‚ã«ã¯ã€ã“ã‚Œã‚‰ã®ä¸¡æ–¹ã‚’åæ™‚è¨ˆå›ã‚Šã«æœ€å¾Œã¾ã§å›ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

    |img_PIR_TTE|


**é…ç·š**

|wiring_passager_counter| 


**ã‚³ãƒ¼ãƒ‰**

.. note::

    * ``kepler-kit-main/micropython`` ãƒ‘ã‚¹ã®ä¸‹ã«ã‚ã‚‹ ``7.4_passenger_counter.py`` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãã‹ã€ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’Thonnyã«ã‚³ãƒ”ãƒ¼ã—ã¦ã‹ã‚‰ã€ã€ŒRun Current Scriptã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã‹ã€å˜ã«F5ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

    * ç”»é¢ã®å³ä¸‹éš…ã«ã‚ã‚‹ã€ŒMicroPythonï¼ˆRaspberry Pi Picoï¼‰ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã“ã¨ã‚’å¿˜ã‚Œãªã„ã§ãã ã•ã„ã€‚

    * è©³ç´°ãªãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã¯ã€ :ref:`open_run_code_py` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚


.. code-block:: python

    import machine
    import time

    pir_sensor = machine.Pin(16, machine.Pin.IN)

    SEGCODE = [0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f]

    sdi = machine.Pin(18,machine.Pin.OUT)
    rclk = machine.Pin(19,machine.Pin.OUT)
    srclk = machine.Pin(20,machine.Pin.OUT)

    placePin = []
    pin = [10,13,12,11]
    for i in range(4):
        placePin.append(None)
        placePin[i] = machine.Pin(pin[i], machine.Pin.OUT)

    count = 0

    def pickDigit(digit):
        for i in range(4):
            placePin[i].value(1)
        placePin[digit].value(0)

    def clearDisplay():
        hc595_shift(0x00)

    def hc595_shift(dat):
        rclk.low()
        time.sleep_us(200)
        for bit in range(7, -1, -1):
            srclk.low()
            time.sleep_us(200)
            value = 1 & (dat >> bit)
            sdi.value(value)
            time.sleep_us(200)
            srclk.high()
            time.sleep_us(200)
        time.sleep_us(200)
        rclk.high()

    def motion_detected(pin):
        global count
        count = count+1

    pir_sensor.irq(trigger=machine.Pin.IRQ_RISING, handler=motion_detected)

    while True:
        #print(count)
        
        pickDigit(0)
        hc595_shift(SEGCODE[count%10])

        pickDigit(1)
        hc595_shift(SEGCODE[count%100//10])
        
        pickDigit(2)
        hc595_shift(SEGCODE[count%1000//100])
        
        pickDigit(3)
        hc595_shift(SEGCODE[count%10000//1000])

ã‚³ãƒ¼ãƒ‰ãŒå®Ÿè¡Œã•ã‚ŒãŸã¨ãã€PIRãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å‰ã‚’èª°ã‹ãŒé€šéã™ã‚‹ã¨ã€4æ¡ã®7ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ä¸Šã®æ•°å­—ãŒ1ã¤å¢—åŠ ã—ã¾ã™ã€‚
